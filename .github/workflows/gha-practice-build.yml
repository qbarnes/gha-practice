name: gha-practice-build

on:
  workflow_call:
    inputs:
      config-path:
        required: true
        type: string
      secrets:
        envPAT:
          required: true
    outputs:
      build_version:
        description: Build version
        value: ${{ env.build_version }}

  push:
    branches: [ "test_build" ]
  pull_request:
    branches: [ "test_build" ]


#permissions:
#add this later


jobs:
  build_all:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Read version and save in "build_version" environment var
        id: build_version
        run: echo "build_version=$(make show_version)" >> $GITHUB_ENV

      - name: Build Linux
        run:  make

      - name: Build MS-DOS
        run:  make TARGET_OS=MSDOS

      - name: Build Full Release
        run:  make fullrelease
